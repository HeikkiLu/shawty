<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>shawty â€” URL Shortener</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            rel="stylesheet"
            href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css"
        />
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <style>
            :root {
                --color-bg: #fff8f0;
                --color-primary: #61e786;
                --color-primary-contrast: #fff;
                --color-text: #48435c;
                --color-text-muted: #5a5766;
                --color-accent: #9792e3;
            }

            html,
            body {
                height: 100%;
                background: var(--color-bg);
                color: var(--color-text);
            }
            body {
                margin: 0;
                display: flex;
                justify-content: center;
                align-items: flex-start;
                text-align: center;
            }

            /* MAIN LAYOUT */
            main.container {
                max-width: clamp(640px, 80vw, 900px);
                width: 100%;
                min-height: 100svh;
                display: grid;
                grid-template-rows: auto auto auto 1fr;
                row-gap: 1rem;
                box-sizing: border-box;
                padding: 6vh 1rem;
            }

            main.container > section {
                display: contents;
            }

            h1,
            h2,
            h3 {
                color: var(--color-text);
            }
            h1 {
                margin-bottom: 0.25rem;
            }
            .mono {
                font-family:
                    ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            }

            /* Submit button color */
            .submit {
                background: var(--color-accent);
                color: var(--color-primary-contrast);
            }

            /* FORM */
            .grid-2 {
                display: grid;
                gap: 1rem;
                grid-template-columns: minmax(0, 1fr) auto;
                width: 100%;
                margin: 0 auto;
                align-items: center;
                max-width: 720px;
            }
            .grid-2 input {
                width: 100%;
            }
            .grid-2 button {
                white-space: nowrap;
                padding-inline: 1.25rem;
            }

            /* Stack on small screens */
            @media (max-width: 640px) {
                .grid-2 {
                    grid-template-columns: 1fr;
                }
                .grid-2 button {
                    width: 100%;
                }
            }

            /* RESULT */
            #out {
                max-width: 720px;
                margin: 0 auto;
            }
            #copy,
            #open[role="button"] {
                background: var(--color-primary);
                color: var(--color-primary-contrast);
            }
            button.secondary,
            a.secondary[role="button"] {
                background: var(--color-accent);
                color: var(--color-primary-contrast);
            }

            /* HISTORY */
            .history {
                margin-top: 1rem;
                display: flex;
                flex-direction: column;
                min-height: 0;
            }
            .history h3 {
                margin: 0 0 0.5rem;
                position: sticky;
                top: 0;
                background: var(--color-bg);
                padding-bottom: 0.25rem;
            }
            .history ul {
                list-style: none;
                padding: 0;
                margin: 0;
                flex: 1;
                min-height: 0;
                overflow: auto;
                padding-right: 0.25rem;
            }
            .history li {
                margin: 0.5rem 0;
                padding: 0.75rem;
                border: 1px solid var(--color-accent);
                border-radius: 6px;
                background: #fff;
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }
            .history li a {
                font-weight: 500;
                color: var(--color-primary);
                text-decoration: none;
            }
            .history li small {
                font-family:
                    ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
                color: var(--color-text-muted);
                margin-top: 0.25rem;
                word-break: break-all;
            }

            /* Inputs */
            input[type="url"],
            input[readonly] {
                border: 1px solid var(--color-accent);
                background: #fff;
                color: var(--color-text);
            }
        </style>
    </head>
    <body>
        <main class="container">
            <section>
                <h1>shawty</h1>
                <p>Shrink links.</p>

                <form id="form" class="grid-2" autocomplete="off">
                    <input
                        id="url"
                        name="url"
                        type="url"
                        placeholder="https://example.com/very/long/link"
                        required
                        aria-label="Long URL"
                        autofocus
                    />
                    <button class="submit" type="submit">Shorten</button>
                </form>
                <small id="hint">Only http/https are supported.</small>

                <article id="out" style="display: none; margin-top: 1rem">
                    <header><strong>Your short link</strong></header>
                    <input id="short" class="mono" type="text" readonly />
                    <button id="copy" class="secondary" type="button">
                        Copy
                    </button>
                    <a
                        id="open"
                        class="secondary"
                        role="button"
                        target="_blank"
                        rel="noopener"
                        >Open</a
                    >
                </article>

                <article
                    id="err"
                    style="display: none; margin-top: 1rem"
                    class="contrast"
                >
                    <strong>Oops:</strong> <span id="errmsg"></span>
                </article>

                <section class="history">
                    <h3>Recent links</h3>
                    <ul id="hist"></ul>
                </section>
            </section>
        </main>

        <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
        <script>
            const API_BASE = "";
            const form = document.getElementById("form");
            const urlInput = document.getElementById("url");
            const out = document.getElementById("out");
            const shortEl = document.getElementById("short");
            const copyBtn = document.getElementById("copy");
            const openA = document.getElementById("open");
            const errBox = document.getElementById("err");
            const errMsg = document.getElementById("errmsg");
            const hist = document.getElementById("hist");
            const qrCanvas = document.getElementById("qr");

            const saveHistory = (item) => {
                const key = "shawt.history";
                const arr = JSON.parse(localStorage.getItem(key) || "[]");
                arr.unshift(item);
                localStorage.setItem(key, JSON.stringify(arr.slice(0, 10)));
                renderHistory();
            };

            const renderHistory = () => {
                const arr = JSON.parse(
                    localStorage.getItem("shawt.history") || "[]",
                );
                hist.innerHTML = "";
                for (const { long, short } of arr) {
                    const li = document.createElement("li");
                    li.innerHTML = `
                  <a href="${short}" target="_blank" rel="noopener">${short}</a>
                  <small>${long}</small>
                `;
                    hist.appendChild(li);
                }
            };

            const showError = (msg) => {
                errMsg.textContent = msg || "Something went wrong";
                errBox.style.display = "";
                out.style.display = "none";
            };

            const showResult = ({ short_url, long_url }) => {
                errBox.style.display = "none";
                shortEl.value = short_url;
                openA.href = short_url;
                openA.textContent = "Open";
                out.style.display = "";
                out.scrollIntoView({ behavior: "smooth", block: "start" });

                saveHistory({ long: long_url, short: short_url });
            };

            form.addEventListener("submit", async (e) => {
                e.preventDefault();
                const url = urlInput.value.trim();
                try {
                    const res = await fetch(API_BASE + "/shorten", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ url }),
                    });
                    const data = await res.json().catch(() => ({}));
                    if (!res.ok)
                        return showError(data.error || `HTTP ${res.status}`);
                    showResult(data);
                    urlInput.select();
                } catch (err) {
                    showError(err.message);
                }
            });

            copyBtn.addEventListener("click", async () => {
                try {
                    await navigator.clipboard.writeText(shortEl.value);
                    copyBtn.textContent = "Copied!";
                    setTimeout(() => (copyBtn.textContent = "Copy"), 1000);
                } catch {}
            });

            renderHistory();
        </script>
    </body>
</html>
